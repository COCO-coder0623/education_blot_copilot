# 🔧 项目启动和功能问题排查指南

## 🚨 项目启动失败 - "localhost拒绝连接"

### ✅ 依赖已安装完成
- Node.js版本: v22.17.1 ✅
- Vite版本: 5.4.8 ✅  
- 依赖包已安装 ✅

### 🚀 手动启动步骤（推荐）
由于VS Code终端工具有问题，请手动启动：

```powershell
# 1. 打开新的PowerShell窗口
# 2. 切换到项目目录
cd d:\01-coco\project-bolt-github-tcwaodf7\project\education

# 3. 启动开发服务器
npm run dev
# 或者使用
npx vite

# 如果端口被占用
npx vite --port 5174
```

### 🎯 一键启动脚本
双击运行以下文件：
```
📁 education/start.bat
```

### 常见启动错误
| 错误信息 | 原因 | 解决方案 |
|---------|------|----------|
| "vite不是内部命令" | Vite未安装 | 使用`npx vite` |
| "EADDRINUSE :::5173" | 端口被占用 | 使用`--port 5174` |
| "Module not found" | 依赖问题 | 重新安装依赖 |
| Node版本错误 | Node.js过旧 | 升级到Node 18+ |

## 📋 上传页面白屏问题

### 问题描述
访问 `http://localhost:5173/upload` 时出现白屏现象

## 🔍 排查步骤

### 1. 检查开发服务器状态
```bash
# 确认服务器正在运行
npm run dev
```
✅ 服务器已经在运行: http://localhost:5173/

### 2. 检查浏览器控制台错误
打开浏览器开发者工具 (F12)，查看：
- Console 标签页的错误信息
- Network 标签页的请求失败
- Sources 标签页的编译错误

### 3. 检查TypeScript编译错误
我们已经修复了主要的TypeScript错误：
- ✅ React导入问题已修复
- ✅ 文件类型问题已修复  
- ✅ 函数参数问题已修复

### 4. 检查路由配置
```tsx
// App.tsx 中的路由配置正常
<Route path="/upload" element={<Upload />} />
```

## 🛠️ 解决方案

### 方案1: 使用简化版Upload组件 (已实施)
我们已经创建了一个简化版的Upload组件，移除了可能导致问题的复杂依赖。

### 方案2: 测试页面验证
访问测试页面验证基础功能：
```
http://localhost:5173/test-upload.html
```

### 方案3: 清除缓存和重启
```bash
# 清除npm缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules
npm install

# 重启开发服务器
npm run dev
```

### 方案4: 检查具体错误信息
如果仍然白屏，请：

1. **打开浏览器开发者工具** (F12)
2. **切换到Console标签页**
3. **刷新页面**
4. **截图或复制错误信息**

常见错误类型：
- `Module not found` - 模块导入问题
- `Unexpected token` - 语法错误  
- `TypeError` - 类型错误
- `Network Error` - 网络请求问题

## 🎯 当前状态

### ✅ 已修复的问题
1. React导入语法错误
2. TypeScript类型错误
3. 函数参数类型问题
4. 组件导入问题

### 📱 可用的功能
1. **测试页面**: http://localhost:5173/test-upload.html
   - 基础文件上传
   - 拖拽功能
   - 模拟OCR测试
   - 模拟AI批改测试

2. **主应用**: http://localhost:5173/
   - 仪表板页面
   - 导航功能

### 🔧 下一步操作

1. **如果测试页面正常工作**:
   - 说明基础功能没问题
   - 可能是React组件的特定问题
   - 建议逐步迁移功能到React组件

2. **如果测试页面也有问题**:
   - 可能是服务器配置问题
   - 检查网络连接
   - 检查端口占用

3. **如果需要完整功能**:
   - 配置API密钥
   - 测试真实的OCR和AI功能

## 💡 建议

### 临时解决方案
使用测试页面进行功能验证和演示：
```
http://localhost:5173/test-upload.html
```

### 长期解决方案
1. 逐步重构Upload组件
2. 添加错误边界组件
3. 完善错误处理
4. 添加加载状态

## 📞 需要帮助？

如果问题仍然存在，请提供：

1. **浏览器控制台的错误信息**
2. **网络请求的状态**
3. **具体的操作步骤**
4. **使用的浏览器版本**

这样我们可以更精确地定位和解决问题。

---

## 🎉 快速测试

现在就可以测试功能了：

1. 访问 http://localhost:5173/test-upload.html
2. 上传一张图片
3. 点击"一键批改"测试完整流程
4. 查看模拟的批改结果

如果测试页面工作正常，说明基础架构没问题，我们可以进一步优化React组件。

---

## 🤖 "OCR识别后不能一键批改"问题解决

### ✅ 问题已修复
- 在OCR识别完成后，会显示一个醒目的 **"🤖 AI智能批改"** 按钮
- 用户可以先检查OCR识别结果，然后点击AI批改按钮

### 🚀 推荐操作流程

**方式A：快速批改（推荐新手）**
1. 上传作业图片
2. 直接点击 **"一键批改"** 按钮
3. 等待3分钟自动完成

**方式B：精确批改（推荐专业用户）**
1. 上传作业图片  
2. 点击 **"OCR识别题目"** 按钮
3. 检查并编辑识别结果（如有错误）
4. 点击 **"🤖 AI智能批改"** 按钮
5. 等待AI分析完成

### 🔧 按钮功能说明
| 按钮名称 | 功能 | 使用场景 |
|---------|------|----------|
| **一键批改** | OCR识别+AI批改一次完成 | 图片质量好，追求速度 |
| **OCR识别题目** | 仅提取题目文字，不批改 | 需要检查/编辑识别结果 |
| **🤖 AI智能批改** | 基于OCR结果进行AI批改 | OCR识别完成后使用 |
| **高级批改** | 图像+文字双重分析 | 复杂题目，需要最高精度 |

### 💡 优化建议
- 如果OCR识别错误率高，建议重新拍摄更清晰的照片
- 编辑OCR结果时，确保题目内容完整准确
- AI批改依赖OCR识别质量，识别越准确批改越精确

---

## 🐛 "AI无法处理内容"错误解决

### 问题描述
出现类似错误：`批改失败: AI无法处理内容: ```json { ... } ```报错`

### 🔍 错误原因
1. **JSON格式问题**：AI返回的JSON数据格式不完整或有语法错误
2. **数据验证失败**：返回的数据缺少必要字段
3. **字符编码问题**：特殊字符导致解析失败
4. **API响应异常**：网络中断或API临时故障

### ✅ 解决方案

**立即解决方法：**
1. **重新尝试批改**：点击批改按钮重试，AI可能会返回正确格式
2. **检查图片质量**：使用更清晰、光线充足的图片
3. **分步批改**：先OCR识别，检查结果，再AI批改

**系统已自动修复：**
- ✅ 增强了JSON解析容错能力
- ✅ 自动修复常见的格式问题
- ✅ 提供fallback批改结果
- ✅ 详细的错误诊断信息

**预防措施：**
```
📸 图片要求：
• 分辨率 ≥ 1200x800
• 文字清晰可读
• 光线充足均匀
• 避免倾斜超过15度

📝 题目要求：
• 题目完整可见
• 答案标记清楚
• 避免手指遮挡
• 背景干净简洁
```

### 🔧 技术细节
系统现在会：
1. 自动修复JSON格式错误
2. 验证和补全缺失字段
3. 提供详细的错误信息
4. 在解析失败时生成fallback结果

### 📞 如果问题持续
查看浏览器控制台(F12)获取详细错误信息：
```javascript
// 在控制台运行测试
await window.testAIGrading()
```
